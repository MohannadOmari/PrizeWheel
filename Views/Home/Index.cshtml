@model List<string>
@{
    ViewData["Title"] = "Home Page";
}


<div class="canvasContainer">
    <canvas id='canvas' width='700' height='350'>
        Canvas not supported, use another browser.
    </canvas>
    <img src="~/pointer.png" alt="V" id="pointer" />
    <button class="btn btn-primary" onclick="PrizeWon(); this.disabled = true;">Spin The Wheel</button>
</div>


<script>
    let theWheel = new Winwheel({
        'numSegments': @Model.Count,
        'segments': [ //add more segments here depending on how many items are in inventory
        {'fillStyle': 'blue', 'text': '@Model[0]'},
        {'fillStyle': 'cyan', 'text': '@Model[1]'},
        {'fillStyle': 'crimson', 'text': '@Model[2]'},
        {'fillStyle': 'navy', 'text': '@Model[3]'}
        ],
        'animation': {
            'type': 'spinToStop',
            'duration': 5,
            'spins': 10,
            'callbackFinished' : 'alertPrize()',
        },
        'responsive': true,
        'lineWidth': 3,
        'pointerGuide' :        // Turn pointer guide on.
        {
            'display'     : true,
            'strokeStyle' : 'yellow',
            'lineWidth'   : 5
        }
    });

    let xhr = new XMLHttpRequest();
    xhr.onreadystatechange = ajaxStateChange;

    function PrizeWon() {
        xhr.open("GET", "@Url.Action("PrizeWon")", true);
        xhr.send('');
    }

    function ajaxStateChange() {
        if (xhr.readyState < 4) {
            return;
        }
 
        if (xhr.status !== 200) {
            return;
        }
 
        // The request has completed.
        if (xhr.readyState === 4) {
            let segmentNumber = xhr.responseText;   // The segment number should be in response.
 
            if (segmentNumber) {
                // Get random angle inside specified segment of the wheel.
                let stopAt = theWheel.getRandomForSegment(segmentNumber);
 
                // Important thing is to set the stopAngle of the animation before stating the spin.
                theWheel.animation.stopAngle = stopAt;
 
                // Start the spin animation here.
                theWheel.startAnimation();
            }
        }
    }

    function alertPrize() {
        let winningSegment = theWheel.getIndicatedSegment();

        alert(winningSegment.text + " friend");
    }
</script>